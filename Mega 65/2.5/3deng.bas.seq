0 DSAVE"@3DENGINE25"10 SCREEN 320,200,211 PALETTE 0,0,0,0,0:PALETTE 0,1,15,15,15:SCNCLR 012 PEN 130 GX=5:GY=210:GZ=180:P=3.1415926535/18040 CF=5:CD=0:CC=10050 FS=400:DX=160:DY=100:L=16:CP=260 OPEN8,8,12,"VERTEX,SEQ,READ"70 INPUT#8,C,D,H,U:DIMU(U):DIMSL(U)80 DIMX%(C):DIMY%(C):DIMZ%(C):DIMXI(U)90 DIMVX%(C):DIMVY%(C):FR=FRE(0):FR=INT((FR/2)/7)100 DIM OO%(2000):DIM OI%(2000):DIM FF%(2000)110 CHAR 0,0,1,1,2,"LOADING VERTICES "120 FORA=1TOC130 INPUT#8,X%(A),Y%(A),Z%(A)150 PEN0:CHAR 0,8,1,1,2,CHR$(18)+"           ": PEN1:CHAR 0,8,1,1,2,STR$(A)+"/"+STR$(C)160 NEXT170 CLOSE8:GOTO470210 REM220 GETKEYA$230 IFA$="X"THENGOSUB3200:PRINT"ANGLE X-AXIS ("+STR$(GX)+")":INPUTGX:SCREEN CLOSE240 IFA$="Y"THENGOSUB3200:PRINT"ANGLE Y-AXIS ("+STR$(GY)+")":INPUTGX:SCREEN CLOSE250 IFA$="Z"THENGOSUB3200:PRINT"ANGLE Z-AXIS ("+STR$(GZ)+")":INPUTGX:SCREEN CLOSE320 IFA$="V"THENGOSUB3200:PRINT"VERTICAL POS DY ("+STR$(DY)+")":INPUTDY:SCREEN CLOSE330 IFA$="H"THENGOSUB3200:PRINT"HORIZONTAL POS DX ("+STR$(DX)+")":INPUTDX:SCREEN CLOSE340 IFA$="C"THENGOSUB3200:PRINT"ONLY FACES OVER CP ("+STR$(CP)+")":INPUTCP:SCREEN CLOSE355 IFA$="P"THENGOSUB2400356 IFA$="F"THENGOSUB2398:GOTO210357 IFA$="B"THEN CLR:GOTO10370 IFA$="E"THENGOSUB3200:PRINT"FISHEYE FS ("+STR$(FS)+")":INPUTFS:SCREEN CLOSE390 IFA$="M"THENGOSUB3200:PRINT"ZOOM L ("+STR$(L)+")":INPUTL:SCREEN CLOSE410 IFA$="L"THEN SCNCLR 0:GOTO690412 IFA$="D"THEN CF=(NOT(CF))+2:CD=(NOT(CD))+2420 REM430 IF A$="I"THENGOSUB3100:GOTO210460 REM470 REM480 SCREEN 320,200,2:SCNCLR 0490 REM500 RX=GX*P510 RY=GY*P520 RZ=GZ*P530 CX=COS(RX):SX=SIN(RX)540 CY=COS(RY):SY=SIN(RY)550 CZ=COS(RZ):SZ=SIN(RZ)560 REM570 FORNP=1TOC575 GETB$:IFB$<>""THEN 210580 XP=X%(NP)/D*L590 YP=Y%(NP)/D*L600 ZP=Z%(NP)/D*L610 REM620 GOSUB1290630 X1=DX+INT(((XP*FS)/(ZP+FS))+0.5)640 Y1=DY+INT(((YP*FS)/(ZP+FS))+0.5)641 VX%(NP)=X1642 VY%(NP)=Y1650 DOT X1,Y1660 NEXT670 PEN0:CHAR 0,0,1,1,2,CHR$(18)+"                 ":PEN1:CHAR 0,0,1,1,2,"!":GOTO210680 REM690 PEN 1698 PEN0:CHAR 0,0,1,1,2,CHR$(18)+"                 ":PEN1:CHAR 0,0,1,1,2,"FIND FACES "700 OPEN8,8,12,"PLANES,SEQ,READ"710 I=1:FR=0:FF=0:II=0:FV=0720 FORA=1TOH725 IFI=1THENINPUT#8,M1,M2,M3:GOSUB4000730 INPUT#8,V740 U(I)=V750 IFV>0THENI=I+1:ELSE FR=FR+1:GOSUB790:I=1770 NEXT780 CLOSE8:GOSUB1500:GOTO210790 REM791 IFVS=0THEN RETURN792 GOSUB2390793 IF AR<=CP THEN RETURN810 OO=0820 FORG=1TOI-2830 LINE VX%(U(G)),VY%(U(G)),VX%(U(G+1)),VY%(U(G+1))831 XP=X%(U(G)):YP=Y%(U(G)):ZP=Z%(U(G))832 GOSUB1290840 OO=OO+ZP850 NEXT851 XP=X%(U(G)):YP=Y%(U(G)):ZP=Z%(U(G))852 GOSUB1290860 LINE VX%(U(G)),VY%(U(G)),VX%(U(1)),VY%(U(1))870 REM1190 OO=OO+ZP/G:G=I1200 FF=FF+1:PEN0:CHAR0,8,1,1,2,CHR$(18)+"          ":PEN1:CHAR 0,8,1,1,2,"F:"+STR$(FF)1210 FV=FV+G1220 OO%(FF)=OO1221 OI%(FF)=II+11230 FORYY=1TOG-11240 FF%(II+YY)=U(YY)1250 NEXT1260 FF%(II+G)=FR*(-1):II=II+G1270 RETURN1280 REM1290 REM1300 YT=YP:YP=CX*YT-SX*ZP:ZP=SX*YT+CX*ZP1310 XT=XP:XP=CY*XT+SY*ZP:ZP=-SY*XT+CY*ZP1320 XT=XP:XP=CZ*XT-SZ*YP:YP=SZ*XT+CZ*YP1330 RETURN1340 REM1350 REM1360 X1=VX%(P1):Y1=VY%(P1)1370 X2=VX%(P2):Y2=VY%(P2)1380 X3=VX%(P3):Y3=VY%(P3)1390 RETURN1400 REM1410 REM1420 REM1430 W1=FF1431 CHAR 0,8,1,1,2,"         "1432 CHAR 0,8,1,1,2,"         "1435 PEN0:CHAR 0,8,1,1,2,CHR$(18)+"                  ":PEN1: CHAR 0,8,1,1,2,STR$(FF)+"->"+STR$(W1)+"    "1440 IFW1<=0 THEN 14801445 W1=INT(W1/2):W2=FF-W11450 V=01455 FORN1=0TOW21460 W3=N1+W11465 IF OO%(N1)<OO%(W3) THEN GOSUB 1477:V=11470 NEXT N11475 IFV>0THEN 14501476 GOTO14351477 S1=OO%(N1):OO%(N1)=OO%(W3):OO%(W3)=S11479 S1=OI%(N1):OI%(N1)=OI%(W3):OI%(W3)=S11480 RETURN1490 REM1500 REM1510 REM1520 PEN0:CHAR0,0,1,1,2,CHR$(18)+"    ":PEN1:CHAR0,0,1,1,2,"SORT":CHAR 0,2,1,1,2,""1530 GOSUB14101540 SCNCLR 01550 K=11560 FORJ=1TOFF1570 FORI=OI%(J)TOFV1580 U(K)=FF%(I)1590 IFFF%(I)>0THENK=K+11600 IFFF%(I)<0THENGOSUB1970:K=1:GOTO16401620 NEXTI1630 REM1640 NEXTJ1650 RETURN1660 REM1670 REM1970 G=K1971 IFU(G)<-1THENCS=3:ELSE CS=21980 N=G-1:IT=I:JT=J:TX=DX:TY=DY:TK=K:YN=200:YX=0:UG=U(G):U(G)=U(1)1990 REM2000 FORI=1TON2010 IFVY%(U(I))<YNTHENYN=VY%(U(I))2020 IFVY%(U(I))>YXTHENYX=VY%(U(I))2030 DY=VY%(U(I+1))-VY%(U(I))2040 DX=VX%(U(I+1))-VX%(U(I))2050 IFDY=0THENSL(I)=1.02060 IFDX=0THENSL(I)=0.02070 IF(DY<>0)AND(DX<>0)THEN SL(I)=DX/DY2080 NEXT2100 FORY=YNTOYX-12110 K=02120 REM2130 FORI=1TON2140 IF((VY%(U(I))<=Y)AND(VY%(U(I+1))>Y))THEN GOSUB23502150 IF((VY%(U(I))>Y)AND(VY%(U(I+1))<=Y))THEN GOSUB23502160 NEXT2170 REM2180 FORJ=0TOK-22190 FORI=0TOK-22200 IFXI(I)>XI(I+1)THENT=XI(I):XI(I)=XI(I+1):XI(I+1)=T2210 NEXT2220 NEXT2230 REM2240 FORI=0TOK-1STEP22250 PEN0:LINE XI(I),Y,XI(I+1),Y:REM HERE2260 NEXT2270 NEXT2280 REM2290 FORI=1TON2300 PEN1:LINE VX%(U(I)),VY%(U(I)),VX%(U(I+1)),VY%(U(I+1))2310 NEXT2320 REM2330 I=IT:J=JT:DX=TX:DY=TY:K=TK:U(G)=UG2340 RETURN2350 REM2360 XI(K)=VX%(U(I))+SL(I)*(Y-VY%(U(I)))2370 K=K+12380 RETURN2390 AR=02391 AJ=I-12392 FORAI=1TOI-12393 AR=AR+(VX%(U(AJ))+VX%(U(AI)))*(VY%(U(AJ))-VY%(U(AI)))2394 AJ=AI2395 NEXT AI2396 AR=ABS(AR/2)2397 RETURN2398 IFFC=0THEN BORDER 2:FC=1:ELSE BORDER 0:FC=02399 RETURN2400 REM SAVE ROUTINE2405 SAVEIFF"RENDER.IFF"2620 GOSUB12903090 RETURN3100 CHAR 0,8,1,1,2,"GX:"+STR$(GX)+" DX:"+STR$(DX)+" L:"+STR$(L)3110 CHAR 0,16,1,1,2,"GY:"+STR$(GY)+" DY:"+STR$(DY)+" M:"+STR$(FRE(0))3120 CHAR 0,24,1,1,2,"GZ:"+STR$(GZ)+" FS:"+STR$(FS)+" CD:"+STR$(CD)3130 RETURN3200 FORI=0TO20:PRINTCHR$(13):NEXT:SCREEN CLOSE3210 RETURN4000 XP=M1:YP=M2:ZP=M34620 GOSUB12904670 VS=0:IFZP<0.0THENVS=14780 RETURN